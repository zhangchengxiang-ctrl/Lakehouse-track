apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: starrocks-fe
  namespace: lakehouse-track
  labels:
    app: starrocks-fe
spec:
  serviceName: starrocks-fe
  replicas: 1
  selector:
    matchLabels:
      app: starrocks-fe
  template:
    metadata:
      labels:
        app: starrocks-fe
    spec:
      containers:
        - name: fe
          image: starrocks/fe-ubuntu:3.5.12
          ports:
            - containerPort: 8030
              name: http
            - containerPort: 9020
              name: rpc
            - containerPort: 9030
              name: mysql
          resources:
            requests:
              cpu: "1"
              memory: 4Gi
            limits:
              cpu: "2"
              memory: 8Gi
          env:
            - name: HOST_TYPE
              value: FQDN
            - name: JAVA_TOOL_OPTIONS
              value: "--add-opens=java.base/java.util=ALL-UNNAMED"
          volumeMounts:
            - name: fe-meta
              mountPath: /opt/starrocks/fe/meta
          livenessProbe:
            tcpSocket:
              port: 9030
            initialDelaySeconds: 120
            periodSeconds: 15
          readinessProbe:
            exec:
              command: ["mysql", "-uroot", "-h127.0.0.1", "-P9030", "-e", "SELECT 1"]
            initialDelaySeconds: 60
            periodSeconds: 10
  volumeClaimTemplates:
    - metadata:
        name: fe-meta
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 20Gi
