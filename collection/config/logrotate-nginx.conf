/var/log/nginx/access.log {
    size 500M
    rotate 2
    create 0644 root root
    compress
    delaycompress
    missingok
    notifempty
    # 关键：用 create + USR1 替代 copytruncate
    # copytruncate 在 cp 与 truncate 之间存在窗口，高并发下会丢日志
    # USR1 让 Nginx 优雅地关闭旧文件句柄并打开新文件，零数据丢失
    postrotate
        [ -f /var/run/nginx.pid ] && kill -USR1 $(cat /var/run/nginx.pid) 2>/dev/null || true
    endscript
}
